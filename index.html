<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8'>
    <title>Force Layout Example 3</title>
    <link href="http://netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">
    <style>
        .node {
            fill: #ccc;
            stroke: #fff;
            stroke-width: 1px;
        }

        .link {
            stroke: #777;
            stroke-width: 2px;
        }

        button {
            position: absolute;
            width: 30px;
        }

        button#slow {
            margin-left: 40px;
        }
    </style>
</head>
<body>
<button id="advance" title="Advance Layout One Increment">
    <i class="fa fa-step-forward"></i>
</button>
<button id="slow" title="Run Layout in Slow Motion">
    <i class="fa fa-play"></i>
</button>

<script src='https://d3js.org/d3.v3.min.js'></script>
<script>
    const width = 800;
    const height = 600;

    const svg = d3.select('body').append('svg')
        .attr('width', width)
        .attr('height', height);

    const graph = {
        "nodes": [
            {x: width/2, y: height/2},
            {x: width/2, y: height/2},
            {x: width/2, y: height/2},
            {x: width/2, y: height/2},
            {x: width/2, y: height/2},
        ]
        ,
        "links": [
            {source: 0, target: 1},
            {source: 0, target: 2},
            {source: 0, target: 3},
            {source: 0, target: 4},
            {source: 1, target: 2},
            {source: 1, target: 3},
            {source: 2, target: 4},
        ]
    };

    const nodes = graph.nodes;
    const links = graph.links;


    const force = d3.layout.force()
        .size([width, height])
        .nodes(nodes)
        .links(links);

    force.linkDistance(width / 4);

    const link = svg.selectAll('.link')
            .data(links)
            .enter().append('line')
            .attr('class', 'link')
            .attr('x1', function (d) {
                return nodes[d.source].x;
            })
            .attr('y1', function (d) {
                return nodes[d.source].y;
            })
            .attr('x2', function (d) {
                return nodes[d.target].x;
            })
            .attr('y2', function (d) {
                return nodes[d.target].y;
            })
        ;

    const node = svg.selectAll('.node')
            .data(nodes)
            .enter().append('circle')
            .attr('class', 'node')
            .attr('r', width / 100)
            .attr('cx', function (d) {
                return d.x;
            })
            .attr('cy', function (d) {
                return d.y;
            })
        ;

    let animating = false;
    const animationStep = 400;

    // when calculations are done
    force.on('tick', () => {

        node.transition().ease('linear').duration(animationStep)
            .attr('cx', (d) => {
                return d.x;
            })
            .attr('cy', (d) => {
                return d.y;
            })
        ;

        link.transition().ease('linear').duration(animationStep)
            .attr('x1', (d) => {
                return d.source.x;
            })
            .attr('y1', (d) => {
                return d.source.y;
            })
            .attr('x2', (d) => {
                return d.target.x;
            })
            .attr('y2', (d) => {
                return d.target.y;
            })
        ;

        force.stop();

        if (animating) {
            setTimeout(
                () => {
                    force.start();
                },
                animationStep
            );
        }
    });

    d3.select("#advance").on("click", force.start);

    d3.select("#slow").on("click", () => {
        d3.selectAll("button").attr("disabled", "disabled");

        animating = true;

        force.start();
    });

</script>
</body>
</html>